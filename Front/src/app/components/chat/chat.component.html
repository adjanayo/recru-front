<div class="fixed bottom-4 right-4 w-96 bg-white rounded-xl shadow-2xl z-50 flex flex-col" style="height: 600px; max-height: 80vh;">
  <!-- Header -->
  <div class="bg-terracotta-600 text-white p-4 rounded-t-xl flex items-center justify-between">
    <div>
      <h3 class="font-bold text-lg">Questions sur le poste</h3>
      <p class="text-sm text-terracotta-100 truncate">{{ jobTitle }}</p>
    </div>
    <button (click)="onClose()" class="hover:bg-terracotta-700 rounded-full p-1 transition-colors">
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <!-- Messages -->
  <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
    @if (messages().length === 0) {
      <div class="text-center text-gray-500 mt-8">
        <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
        </svg>
        <p class="text-sm">Posez vos questions sur ce poste</p>
        <p class="text-xs mt-2">Un recruteur vous r√©pondra rapidement</p>
      </div>
    }

    @for (message of messages(); track message.id) {
      <div [class]="message.isBot ? 'flex items-start gap-2' : 'flex items-start gap-2 flex-row-reverse'">
        <!-- Avatar -->
        <div [class]="message.isBot ? 'w-8 h-8 rounded-full bg-terracotta-100 flex items-center justify-center flex-shrink-0' : 'w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0'">
          @if (message.userAvatar) {
            <img [src]="message.userAvatar" [alt]="message.userName" class="w-8 h-8 rounded-full object-cover" />
          } @else {
            <span [class]="message.isBot ? 'text-terracotta-600 text-sm font-medium' : 'text-blue-600 text-sm font-medium'">
              {{ message.userName.charAt(0) }}
            </span>
          }
        </div>

        <!-- Message content -->
        <div [class]="message.isBot ? 'flex-1' : 'flex-1 text-right'">
          <div [class]="message.isBot ? 'inline-block bg-white rounded-lg px-4 py-2 shadow-sm max-w-xs' : 'inline-block bg-terracotta-600 text-white rounded-lg px-4 py-2 shadow-sm max-w-xs'">
            @if (message.isBot) {
              <p class="text-xs font-medium text-gray-600 mb-1">{{ message.userName }}</p>
            }
            <p class="text-sm">{{ message.message }}</p>
            <p [class]="message.isBot ? 'text-xs text-gray-400 mt-1' : 'text-xs text-terracotta-200 mt-1'">
              {{ formatTime(message.timestamp) }}
            </p>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Input -->
  <div class="p-4 border-t bg-white rounded-b-xl">
    <form (ngSubmit)="sendMessage()" class="flex gap-2">
      <input
        type="text"
        [value]="messageText()"
        (input)="messageText.set($any($event.target).value)"
        placeholder="Posez votre question..."
        [disabled]="isSending()"
        class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-terracotta-500 focus:border-transparent disabled:bg-gray-100"
      />
      <button
        type="submit"
        [disabled]="isSending() || !messageText().trim()"
        class="px-4 py-2 bg-terracotta-600 text-white rounded-lg hover:bg-terracotta-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
      >
        @if (isSending()) {
          <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        } @else {
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
          </svg>
        }
      </button>
    </form>
  </div>
</div>
